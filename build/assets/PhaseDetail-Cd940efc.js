import{c as $,d as z,q as X,o as V,k as J,g as M,h as ee,m as re,s as P,f as oe,r as h,j as e,B as S,i as te,u as se}from"./index-B56gB6y7.js";import{u as A,a as ae,C as R,d as le}from"./Card-CxEH0R_p.js";import{M as ne}from"./Modal-DZJTnJFn.js";import{I as ie}from"./Input-C6ykoCPd.js";const ce=async(r,n,i)=>{try{const o=$(z,"projects",r,"phases",n,"dailyLogs"),t=await oe(o,{date:i.date,todayLog:i.todayLog,tomorrowNeeds:i.tomorrowNeeds,images:[],createdAt:P(),updatedAt:P()});return console.log("âœ… Daily log created:",t.id),{success:!0,id:t.id}}catch(o){return console.error("âŒ Error creating daily log:",o),{success:!1,error:o.message}}},de=async(r,n)=>{try{const i=$(z,"projects",r,"phases",n,"dailyLogs"),o=X(i,V("date","desc")),t=await J(o),a=[];return t.forEach(l=>{a.push({id:l.id,...l.data()})}),console.log("âœ… Fetched daily logs:",a.length),{success:!0,data:a}}catch(i){return console.error("âŒ Error fetching daily logs:",i),{success:!1,error:i.message}}},B=async(r,n,i,o)=>{try{const t=M(z,"projects",r,"phases",n,"dailyLogs",i);return await re(t,{...o,updatedAt:P()}),console.log("âœ… Daily log updated:",i),{success:!0}}catch(t){return console.error("âŒ Error updating daily log:",t),{success:!1,error:t.message}}},ge=async(r,n,i)=>{try{const o=M(z,"projects",r,"phases",n,"dailyLogs",i);return await ee(o),console.log("âœ… Daily log deleted:",i),{success:!0}}catch(o){return console.error("âŒ Error deleting daily log:",o),{success:!1,error:o.message}}},ue=async(r,n,i=[],o=[])=>{try{const t=[...i,...o],a=await A(r,n,{images:t});return a.success?(console.log(`âœ… Added ${o.length} image(s) to phase`),{success:!0,images:t}):{success:!1,error:a.error}}catch(t){return console.error("âŒ Error adding images to phase:",t),{success:!1,error:t.message}}},pe=async(r,n,i,o=[],t=[])=>{try{const a=[...o,...t],l=await B(r,n,i,{images:a});return l.success?(console.log(`âœ… Added ${t.length} image(s) to daily log`),{success:!0,images:a}):{success:!1,error:l.error}}catch(a){return console.error("âŒ Error adding images to daily log:",a),{success:!1,error:a.message}}},me=async(r,n,i=[],o)=>{try{const t=i.filter(l=>l!==o),a=await A(r,n,{images:t});return a.success?(console.log("âœ… Image deleted from phase"),{success:!0,images:t}):{success:!1,error:a.error}}catch(t){return console.error("âŒ Error deleting image from phase:",t),{success:!1,error:t.message}}},ye=async(r,n,i,o=[],t)=>{try{const a=o.filter(g=>g!==t),l=await B(r,n,i,{images:a});return l.success?(console.log("âœ… Image deleted from daily log"),{success:!0,images:a}):{success:!1,error:l.error}}catch(a){return console.error("âŒ Error deleting image from daily log:",a),{success:!1,error:a.message}}},W="dqis32szu",U="daily_logs",he=`https://api.cloudinary.com/v1_1/${W}/image/upload`,fe=async r=>{var n,i,o,t;try{if(!r)return console.error("âŒ No file provided"),{success:!1,error:"No file provided"};if(!r.type.startsWith("image/"))return console.error("âŒ File is not an image:",r.type),{success:!1,error:"File must be an image"};const a=10*1024*1024;if(r.size>a)return console.error("âŒ File too large:",r.size),{success:!1,error:"Image size must be less than 10MB"};console.log("ğŸ“¤ Uploading image to Cloudinary:",r.name,`(${(r.size/1024).toFixed(2)} KB)`);const l=new FormData;l.append("file",r),l.append("upload_preset",U),l.append("cloud_name",W),l.append("folder","construction_tracker");const g=await fetch(he,{method:"POST",body:l}),u=await g.json();return g.ok?(console.log("âœ… Image uploaded successfully:",u.secure_url),{success:!0,url:u.secure_url,publicId:u.public_id,width:u.width,height:u.height,format:u.format,bytes:u.bytes}):(console.error("âŒ Cloudinary upload error:",{status:g.status,statusText:g.statusText,error:u.error,fullResponse:u}),g.status===400?(i=(n=u.error)==null?void 0:n.message)!=null&&i.includes("upload_preset")?{success:!1,error:`Upload preset "${U}" not found or not unsigned. Please create it in Cloudinary dashboard.`}:{success:!1,error:((o=u.error)==null?void 0:o.message)||"Bad request - check upload preset configuration"}:{success:!1,error:((t=u.error)==null?void 0:t.message)||`Upload failed (${g.status})`})}catch(a){return console.error("âŒ Error uploading image:",a),{success:!1,error:a.message||"Upload failed"}}},xe=async r=>{try{if(!r||r.length===0)return console.error("âŒ No files provided"),{success:!1,error:"No files provided"};console.log(`ğŸ“¤ Uploading ${r.length} image(s) to Cloudinary...`);const i=Array.from(r).map(l=>fe(l)),o=await Promise.all(i),t=o.filter(l=>!l.success);if(t.length>0){if(console.error(`âŒ ${t.length} upload(s) failed:`,t),t.length===o.length)return{success:!1,error:`All ${t.length} upload(s) failed: ${t[0].error}`,results:o};const l=o.length-t.length;console.warn(`âš ï¸ ${l} succeeded, ${t.length} failed`)}const a=o.filter(l=>l.success).map(l=>l.url);return console.log(`âœ… Successfully uploaded ${a.length} image(s)`),{success:a.length>0,urls:a,results:o,successCount:a.length,failureCount:t.length}}catch(n){return console.error("âŒ Error uploading multiple images:",n),{success:!1,error:n.message||"Upload failed"}}},F=({onUploadComplete:r,multiple:n=!0,buttonText:i="ğŸ“· Upload Images"})=>{const[o,t]=h.useState(!1),[a,l]=h.useState(""),[g,u]=h.useState([]),[f,c]=h.useState([]),b=h.useRef(null),j=m=>{const p=Array.from(m.target.files);if(p.length===0)return;l(""),u(p);const x=p.map(y=>URL.createObjectURL(y));c(x)},I=async()=>{if(g.length===0){l("Please select images first");return}t(!0),l("");try{console.log(`Uploading ${g.length} image(s)...`);const m=await xe(g);m.success?(console.log("âœ… Upload complete:",m.urls),f.forEach(p=>URL.revokeObjectURL(p)),u([]),c([]),b.current&&(b.current.value=""),r&&r(m.urls)):l(m.error||"Upload failed")}catch(m){console.error("Upload error:",m),l("An unexpected error occurred")}finally{t(!1)}},k=()=>{f.forEach(m=>URL.revokeObjectURL(m)),u([]),c([]),l(""),b.current&&(b.current.value="")};return e.jsxs("div",{style:{marginTop:"var(--spacing-md)"},children:[e.jsx("input",{ref:b,type:"file",accept:"image/*",multiple:n,capture:"environment",onChange:j,style:{display:"none"}}),g.length===0&&e.jsx(S,{variant:"outline",onClick:()=>{var m;return(m=b.current)==null?void 0:m.click()},disabled:o,children:i}),g.length>0&&e.jsxs("div",{style:{padding:"var(--spacing-md)",backgroundColor:"var(--color-bg-tertiary)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"var(--spacing-sm)",marginBottom:"var(--spacing-md)"},children:f.map((m,p)=>e.jsx("div",{style:{position:"relative",paddingBottom:"100%",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-sm)",overflow:"hidden"},children:e.jsx("img",{src:m,alt:`Preview ${p+1}`,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}})},p))}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)",marginBottom:"var(--spacing-md)"},children:[g.length," image",g.length>1?"s":""," selected"]}),a&&e.jsx("div",{style:{padding:"var(--spacing-sm)",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid var(--color-danger)",borderRadius:"var(--radius-sm)",color:"var(--color-danger)",fontSize:"0.875rem",marginBottom:"var(--spacing-md)"},children:a}),e.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)"},children:[e.jsx(S,{variant:"primary",onClick:I,loading:o,disabled:o,children:o?"Uploading...":"Upload"}),e.jsx(S,{variant:"outline",onClick:k,disabled:o,children:"Cancel"})]})]})]})},ve=({images:r=[],initialIndex:n=0,onClose:i})=>{const[o,t]=h.useState(n),[a,l]=h.useState(!1);h.useEffect(()=>{const c=b=>{b.key==="ArrowLeft"?u():b.key==="ArrowRight"?g():b.key==="Escape"&&i()};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[o]),h.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const g=()=>{t(c=>(c+1)%r.length),l(!1)},u=()=>{t(c=>(c-1+r.length)%r.length),l(!1)},f=()=>{l(!a)};return!r||r.length===0?null:e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.95)",zIndex:1e4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},onClick:c=>{c.target===c.currentTarget&&i()},children:[e.jsx("button",{onClick:i,style:{position:"absolute",top:"20px",right:"20px",backgroundColor:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"2rem",color:"white",transition:"background-color 0.2s ease",zIndex:10001},onMouseEnter:c=>{c.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.3)"},onMouseLeave:c=>{c.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)"},children:"Ã—"}),e.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"0.875rem",fontWeight:"500",zIndex:10001},children:[o+1," / ",r.length]}),r.length>1&&e.jsx("button",{onClick:u,style:{position:"absolute",left:"20px",top:"50%",transform:"translateY(-50%)",backgroundColor:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1.5rem",color:"white",transition:"background-color 0.2s ease",zIndex:10001},onMouseEnter:c=>{c.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.3)"},onMouseLeave:c=>{c.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)"},children:"â€¹"}),r.length>1&&e.jsx("button",{onClick:g,style:{position:"absolute",right:"20px",top:"50%",transform:"translateY(-50%)",backgroundColor:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1.5rem",color:"white",transition:"background-color 0.2s ease",zIndex:10001},onMouseEnter:c=>{c.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.3)"},onMouseLeave:c=>{c.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)"},children:"â€º"}),e.jsx("div",{style:{maxWidth:"90%",maxHeight:"90%",display:"flex",alignItems:"center",justifyContent:"center",cursor:a?"zoom-out":"zoom-in"},onClick:f,children:e.jsx("img",{src:r[o],alt:`Image ${o+1}`,style:{maxWidth:a?"none":"100%",maxHeight:a?"none":"100%",width:"auto",height:"auto",objectFit:"contain",borderRadius:"8px",transition:"transform 0.3s ease",transform:a?"scale(1.5)":"scale(1)"}})}),e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"0.75rem",opacity:.7},children:[a?"Click to zoom out":"Click image to zoom in"," â€¢ Arrow keys to navigate â€¢ ESC to close"]})]})},N=({images:r=[],emptyMessage:n="No images yet",onDeleteImage:i,showDelete:o=!0,maxThumbnails:t=3})=>{const[a,l]=h.useState(!1),[g,u]=h.useState(0),[f,c]=h.useState(null);if(!r||r.length===0)return e.jsx("div",{style:{padding:"var(--spacing-lg)",textAlign:"center",color:"var(--color-text-tertiary)",fontSize:"0.875rem"},children:n});const b=p=>{u(p),l(!0)},j=async(p,x,y)=>{if(y.stopPropagation(),!!window.confirm(`Are you sure you want to delete this image?

This action cannot be undone.`)){c(x);try{i&&await i(p,x)}catch(C){console.error("Error deleting image:",C),alert("Failed to delete image. Please try again.")}finally{c(null)}}},I=()=>{u(0),l(!0)},k=r.slice(0,t),m=r.length>t;return e.jsxs(e.Fragment,{children:[r.length>0&&e.jsx("div",{style:{display:"flex",gap:"var(--spacing-sm)",marginTop:"var(--spacing-md)",marginBottom:"var(--spacing-md)"},children:e.jsxs(S,{variant:"outline",size:"small",onClick:I,children:["ğŸ–¼ï¸ View Gallery (",r.length,")"]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"var(--spacing-sm)"},children:[k.map((p,x)=>e.jsxs("div",{style:{position:"relative",paddingBottom:"100%",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",overflow:"hidden",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:y=>{y.currentTarget.style.transform="scale(1.05)",y.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"},onMouseLeave:y=>{y.currentTarget.style.transform="scale(1)",y.currentTarget.style.boxShadow="none"},children:[e.jsx("img",{src:p,alt:`Image ${x+1}`,onClick:()=>b(x),style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}}),o&&i&&e.jsx("button",{onClick:y=>j(p,x,y),disabled:f===x,style:{position:"absolute",top:"8px",right:"8px",backgroundColor:f===x?"rgba(0, 0, 0, 0.5)":"rgba(239, 68, 68, 0.9)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:f===x?"not-allowed":"pointer",fontSize:"1rem",color:"white",transition:"background-color 0.2s ease, transform 0.2s ease",zIndex:10},onMouseEnter:y=>{f!==x&&(y.currentTarget.style.backgroundColor="rgba(220, 38, 38, 1)",y.currentTarget.style.transform="scale(1.1)")},onMouseLeave:y=>{f!==x&&(y.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.9)",y.currentTarget.style.transform="scale(1)")},children:f===x?"â³":"ğŸ—‘ï¸"}),f===x&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",zIndex:9},children:"Deleting..."})]},x)),m&&e.jsx("div",{onClick:I,style:{position:"relative",paddingBottom:"100%",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",overflow:"hidden",cursor:"pointer",border:"2px dashed var(--color-border)",transition:"transform 0.2s ease, border-color 0.2s ease"},onMouseEnter:p=>{p.currentTarget.style.transform="scale(1.05)",p.currentTarget.style.borderColor="var(--color-primary)"},onMouseLeave:p=>{p.currentTarget.style.transform="scale(1)",p.currentTarget.style.borderColor="var(--color-border)"},children:e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-secondary)"},children:[e.jsxs("div",{style:{fontSize:"2rem",marginBottom:"8px"},children:["+",r.length-t]}),e.jsx("div",{style:{fontSize:"0.75rem"},children:"more"})]})})]}),a&&e.jsx(ve,{images:r,initialIndex:g,onClose:()=>l(!1)})]})},be=({isOpen:r,onClose:n,projectId:i,phaseId:o,editLog:t=null,onLogSaved:a})=>{const[l,g]=h.useState(!1),[u,f]=h.useState(""),c=t!==null,b=()=>new Date().toISOString().split("T")[0],[j,I]=h.useState({date:b(),todayLog:"",tomorrowNeeds:""});h.useEffect(()=>{I(t?{date:t.date||b(),todayLog:t.todayLog||"",tomorrowNeeds:t.tomorrowNeeds||""}:{date:b(),todayLog:"",tomorrowNeeds:""})},[t,r]);const k=y=>{const{name:L,value:C}=y.target;I(T=>({...T,[L]:C})),f("")},m=async y=>{y.preventDefault(),g(!0),f("");try{if(!j.date||!j.todayLog.trim()){f("Please fill in date and today's work log"),g(!1);return}console.log(c?"Updating daily log...":"Creating daily log...");const L={date:j.date,todayLog:j.todayLog.trim(),tomorrowNeeds:j.tomorrowNeeds.trim()};let C;c?C=await B(i,o,t.id,L):C=await ce(i,o,L),C.success?(console.log(c?"âœ… Daily log updated":"âœ… Daily log created"),p(),a&&a(),n()):f(C.error||`Failed to ${c?"update":"create"} daily log`)}catch(L){console.error("Error saving daily log:",L),f("An unexpected error occurred. Please try again.")}finally{g(!1)}},p=()=>{I({date:b(),todayLog:"",tomorrowNeeds:""}),f("")},x=()=>{l||(p(),n())};return e.jsx(ne,{isOpen:r,onClose:x,title:c?"âœï¸ Edit Daily Log":"ğŸ“ Add Daily Log",footer:e.jsxs(e.Fragment,{children:[e.jsx(S,{type:"button",variant:"outline",onClick:x,disabled:l,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"primary",loading:l,onClick:m,children:l?"Saving...":c?"Update Log":"Save Log"})]}),children:e.jsxs("form",{onSubmit:m,children:[u&&e.jsx("div",{style:{padding:"var(--spacing-md)",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid var(--color-danger)",borderRadius:"var(--radius-md)",color:"var(--color-danger)",marginBottom:"var(--spacing-lg)",fontSize:"0.875rem"},children:u}),e.jsx(ie,{label:"Date",type:"date",name:"date",value:j.date,onChange:k,required:!0,disabled:l}),e.jsxs("div",{style:{marginTop:"var(--spacing-lg)"},children:[e.jsxs("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"var(--color-text-primary)",marginBottom:"var(--spacing-sm)"},children:["Today's Work Log ",e.jsx("span",{style:{color:"var(--color-danger)"},children:"*"})]}),e.jsx("textarea",{name:"todayLog",value:j.todayLog,onChange:k,placeholder:`Enter today's work...\r
\r
Example:\r
â€¢ Paid â‚¹4000 to driver\r
â€¢ Used 40 tonnes sand\r
â€¢ Weed removal completed\r
â€¢ Levelling done for 100 meters`,required:!0,disabled:l,rows:8,style:{width:"100%",padding:"var(--spacing-md)",backgroundColor:"var(--color-bg-tertiary)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",color:"var(--color-text-primary)",fontSize:"0.9375rem",fontFamily:"inherit",resize:"vertical",lineHeight:"1.6"}}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-text-tertiary)",marginTop:"var(--spacing-xs)"},children:"What work was completed today?"})]}),e.jsxs("div",{style:{marginTop:"var(--spacing-lg)"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"var(--color-text-primary)",marginBottom:"var(--spacing-sm)"},children:"Things Required for Tomorrow"}),e.jsx("textarea",{name:"tomorrowNeeds",value:j.tomorrowNeeds,onChange:k,placeholder:`Enter tomorrow's requirements...\r
\r
Example:\r
â€¢ White cement\r
â€¢ Boundary marking tools\r
â€¢ Extra labour (2 people)\r
â€¢ Sand delivery`,disabled:l,rows:6,style:{width:"100%",padding:"var(--spacing-md)",backgroundColor:"var(--color-bg-tertiary)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",color:"var(--color-text-primary)",fontSize:"0.9375rem",fontFamily:"inherit",resize:"vertical",lineHeight:"1.6"}}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-text-tertiary)",marginTop:"var(--spacing-xs)"},children:"What materials or resources are needed tomorrow?"})]})]})})},Se=()=>{const{projectId:r,phaseId:n}=te(),i=se(),[o,t]=h.useState(null),[a,l]=h.useState([]),[g,u]=h.useState(!0),[f,c]=h.useState(""),[b,j]=h.useState(!1),[I,k]=h.useState(null),[m,p]=h.useState(!1);h.useEffect(()=>{r&&n&&(x(),C())},[r,n]);const x=async()=>{try{const s=await ae(r,n);s.success?t(s.data):c(s.error||"Failed to fetch phase")}catch(s){console.error("Error fetching phase:",s),c("An unexpected error occurred")}finally{u(!1)}},y=async()=>{if(window.confirm(`Are you sure you want to delete this phase: "${o.phaseName}"?

This will delete ALL daily logs associated with this phase. This action cannot be undone.`))try{const d=await le(r,n);d.success?(alert("ğŸš€ Phase and all associated logs deleted successfully!"),i(`/project/${r}`)):alert(`âŒ Failed to delete phase: ${d.error}`)}catch(d){console.error("Error deleting phase:",d),alert("âŒ An unexpected error occurred while deleting the phase")}},L=async s=>{if(!m){p(!0);try{const d=await A(r,n,{status:s});d.success?(t(Q=>({...Q,status:s})),alert(s==="completed"?"âœ… Phase marked as COMPLETED! Work is now locked.":"ğŸ”„ Phase is back IN PROGRESS.")):alert(`âŒ Failed to update status: ${d.error}`)}catch(d){console.error("Error updating status:",d),alert("âŒ An unexpected error occurred while updating status")}finally{p(!1)}}},C=async()=>{try{const s=await de(r,n);s.success?(l(s.data),console.log("âœ… Daily logs loaded:",s.data.length)):console.error("Failed to fetch daily logs:",s.error)}catch(s){console.error("Error fetching daily logs:",s)}},T=()=>{console.log("Daily log saved, refreshing..."),C(),k(null)},O=s=>{k(s),j(!0)},_=async s=>{if(window.confirm(`Are you sure you want to delete this daily log?

Date: ${D(s.date)}

This action cannot be undone.`))try{console.log("Deleting daily log:",s.id);const w=await ge(r,n,s.id);w.success?(console.log("âœ… Daily log deleted successfully"),C()):alert(`Failed to delete log: ${w.error}`)}catch(w){console.error("Error deleting log:",w),alert("An unexpected error occurred while deleting the log")}},q=()=>{j(!1),k(null)},H=async s=>{try{console.log("Uploading phase images:",s);const d=await ue(r,n,o.images||[],s);d.success?(console.log("âœ… Phase images uploaded successfully"),x()):alert(`Failed to upload images: ${d.error}`)}catch(d){console.error("Error uploading phase images:",d),alert("An unexpected error occurred while uploading images")}},Y=async(s,d)=>{try{console.log("Uploading daily log images:",d);const w=await pe(r,n,s.id,s.images||[],d);w.success?(console.log("âœ… Daily log images uploaded successfully"),C()):alert(`Failed to upload images: ${w.error}`)}catch(w){console.error("Error uploading log images:",w),alert("An unexpected error occurred while uploading images")}},G=async s=>{try{console.log("Deleting phase image:",s);const d=await me(r,n,o.images||[],s);d.success?(console.log("âœ… Phase image deleted successfully"),x()):alert(`Failed to delete image: ${d.error}`)}catch(d){console.error("Error deleting phase image:",d),alert("An unexpected error occurred while deleting image")}},Z=async(s,d)=>{try{console.log("Deleting daily log image:",d);const w=await ye(r,n,s.id,s.images||[],d);w.success?(console.log("âœ… Daily log image deleted successfully"),C()):alert(`Failed to delete image: ${w.error}`)}catch(w){console.error("Error deleting log image:",w),alert("An unexpected error occurred while deleting image")}},K=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s),D=s=>s?new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"-";if(g)return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsxs("div",{style:{textAlign:"center",color:"var(--color-text-secondary)"},children:[e.jsx("div",{style:{fontSize:"2rem",marginBottom:"var(--spacing-md)"},children:"â³"}),e.jsx("p",{children:"Loading phase..."})]})});if(f||!o)return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsxs("div",{style:{textAlign:"center",color:"var(--color-danger)"},children:[e.jsx("div",{style:{fontSize:"2rem",marginBottom:"var(--spacing-md)"},children:"âš ï¸"}),e.jsx("p",{children:f||"Phase not found"}),e.jsx(S,{variant:"outline",onClick:()=>i(`/project/${r}`),style:{marginTop:"var(--spacing-md)"},children:"Back to Project"})]})});const E=o.progress||0,v=o.status==="completed";return e.jsxs("div",{style:{backgroundColor:v?"rgba(0, 0, 0, 0.02)":"transparent",minHeight:"100vh",transition:"background-color 0.3s ease"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"var(--spacing-xl)",flexWrap:"wrap",gap:"var(--spacing-md)",paddingTop:"var(--spacing-md)"},children:[e.jsxs("div",{children:[e.jsx(S,{variant:"outline",size:"small",onClick:()=>i(`/project/${r}`),style:{marginBottom:"var(--spacing-sm)"},children:"â† Back to Project"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-md)"},children:[e.jsxs("h1",{style:{margin:0,display:"flex",alignItems:"center",gap:"var(--spacing-sm)",color:v?"var(--color-text-tertiary)":"var(--color-text-primary)"},children:[v&&e.jsx("span",{style:{color:"var(--color-success)",fontSize:"1.5rem"},children:"âœ”"}),o.phaseName]}),v&&e.jsx("span",{style:{color:"var(--color-success)",fontWeight:"600",fontSize:"0.875rem",backgroundColor:"rgba(34, 197, 94, 0.1)",padding:"4px 12px",borderRadius:"var(--radius-full)"},children:"COMPLETED"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-lg)"},children:[e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--color-bg-tertiary)",padding:"4px",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)"},children:[e.jsxs("label",{style:{padding:"6px 12px",cursor:"pointer",borderRadius:"var(--radius-sm)",fontSize:"0.875rem",fontWeight:"500",backgroundColor:v?"transparent":"var(--color-primary)",color:v?"var(--color-text-secondary)":"white",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("input",{type:"radio",name:"status",checked:!v,onChange:()=>L("ongoing"),style:{display:"none"},disabled:m}),m&&!v?"â³":""," In Progress"]}),e.jsxs("label",{style:{padding:"6px 12px",cursor:"pointer",borderRadius:"var(--radius-sm)",fontSize:"0.875rem",fontWeight:"500",backgroundColor:v?"var(--color-success)":"transparent",color:v?"white":"var(--color-text-secondary)",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("input",{type:"radio",name:"status",checked:v,onChange:()=>L("completed"),style:{display:"none"},disabled:m}),m&&v?"â³":""," Completed"]})]}),e.jsx("button",{onClick:y,style:{backgroundColor:"transparent",border:"1px solid var(--color-border)",cursor:"pointer",fontSize:"1.25rem",color:"var(--color-text-tertiary)",padding:"8px",borderRadius:"var(--radius-md)",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:s=>{s.currentTarget.style.color="var(--color-danger)",s.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.1)",s.currentTarget.style.borderColor="var(--color-danger)"},onMouseLeave:s=>{s.currentTarget.style.color="var(--color-text-tertiary)",s.currentTarget.style.backgroundColor="transparent",s.currentTarget.style.borderColor="var(--color-border)"},title:"Delete Phase",children:"âŒ"})]})]}),e.jsxs(R,{title:"Phase Information",style:{marginBottom:"var(--spacing-xl)"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(130px, 1fr))",gap:"var(--spacing-md)",marginBottom:"var(--spacing-xl)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--color-text-tertiary)",fontSize:"0.875rem",marginBottom:"4px"},children:"Work Type"}),e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:"600",color:"var(--color-text-primary)"},children:o.workType})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--color-text-tertiary)",fontSize:"0.875rem",marginBottom:"4px"},children:"Phase Cost"}),e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:"600",color:"var(--color-primary)"},children:K(o.phaseCost)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--color-text-tertiary)",fontSize:"0.875rem",marginBottom:"4px"},children:"Total Quantity"}),e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:"600",color:"var(--color-text-primary)"},children:o.totalQuantity})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--color-text-tertiary)",fontSize:"0.875rem",marginBottom:"4px"},children:"Start Date"}),e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:"600",color:"var(--color-text-primary)"},children:D(o.startDate)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--color-text-tertiary)",fontSize:"0.875rem",marginBottom:"4px"},children:"Status"}),e.jsx("div",{children:e.jsx("span",{style:{padding:"6px 16px",backgroundColor:v?"rgba(34, 197, 94, 0.1)":"rgba(245, 158, 11, 0.1)",color:v?"var(--color-success)":"var(--color-primary)",borderRadius:"var(--radius-md)",fontSize:"0.875rem",fontWeight:"500",textTransform:"capitalize",display:"inline-block"},children:o.status})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--color-text-tertiary)",fontSize:"0.875rem",marginBottom:"4px"},children:"Total Logs"}),e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:"600",color:"var(--color-success)"},children:a.length})]})]}),E>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-sm)"},children:[e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--color-text-tertiary)"},children:"Progress"}),e.jsxs("span",{style:{fontSize:"1.25rem",fontWeight:"600",color:v?"var(--color-success)":"var(--color-primary)"},children:[E,"%"]})]}),e.jsx("div",{style:{width:"100%",height:"12px",backgroundColor:"var(--color-bg-tertiary)",borderRadius:"var(--radius-full)",overflow:"hidden"},children:e.jsx("div",{style:{width:`${E}%`,height:"100%",background:v?"linear-gradient(90deg, #22c55e, #16a34a)":"linear-gradient(90deg, var(--color-primary), #f97316)",transition:"width 0.5s ease-in-out"}})})]})]}),e.jsxs(R,{title:"ğŸ“· Phase Images",style:{marginBottom:"var(--spacing-xl)"},children:[!v&&e.jsx(F,{onUploadComplete:H,buttonText:"ğŸ“· Upload Phase Images",multiple:!0}),e.jsx(N,{images:o.images||[],emptyMessage:"No phase images yet. Upload images to document this phase.",onDeleteImage:G,showDelete:!v,maxThumbnails:3})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-lg)"},children:[e.jsx("h2",{style:{margin:0},children:"ğŸ“ Daily Logs"}),!v&&e.jsx(S,{variant:"primary",onClick:()=>{k(null),j(!0)},children:"â• Add Daily Log"})]}),e.jsx(R,{children:a.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"var(--spacing-2xl)",color:"var(--color-text-tertiary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"var(--spacing-md)"},children:"ğŸ“”"}),e.jsx("p",{children:"No daily logs yet"}),e.jsx("p",{style:{fontSize:"0.875rem",marginBottom:"var(--spacing-lg)"},children:'Click "Add Daily Log" to start tracking daily work'}),e.jsx(S,{variant:"primary",onClick:()=>{k(null),j(!0)},children:"â• Add First Log"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-lg)"},children:a.map(s=>e.jsxs("div",{style:{backgroundColor:"var(--color-bg-tertiary)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"var(--spacing-md) var(--spacing-lg)",backgroundColor:"var(--color-bg-secondary)",borderBottom:"1px solid var(--color-border)"},children:e.jsxs("div",{style:{fontSize:"1rem",fontWeight:"600",color:"var(--color-text-primary)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"},children:["ğŸ“… ",D(s.date)]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"1px",backgroundColor:"var(--color-border)"},children:[e.jsxs("div",{style:{padding:"var(--spacing-lg)",backgroundColor:"var(--color-bg-tertiary)"},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"var(--color-text-tertiary)",marginBottom:"var(--spacing-sm)",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Today's Work"}),e.jsx("div",{style:{fontSize:"0.9375rem",color:"var(--color-text-primary)",lineHeight:"1.7",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:s.todayLog||"-"})]}),e.jsxs("div",{style:{padding:"var(--spacing-lg)",backgroundColor:"var(--color-bg-tertiary)"},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"var(--color-text-tertiary)",marginBottom:"var(--spacing-sm)",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Tomorrow's Needs"}),e.jsx("div",{style:{fontSize:"0.9375rem",color:"var(--color-text-primary)",lineHeight:"1.7",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:s.tomorrowNeeds||"-"})]})]}),e.jsxs("div",{style:{padding:"var(--spacing-lg)",backgroundColor:"var(--color-bg-tertiary)",borderTop:"1px solid var(--color-border)"},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"var(--color-text-tertiary)",marginBottom:"var(--spacing-sm)",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Images"}),!v&&e.jsx(F,{onUploadComplete:d=>Y(s,d),buttonText:"ğŸ“· Upload Images",multiple:!0}),e.jsx(N,{images:s.images||[],emptyMessage:"No images for this log",onDeleteImage:d=>Z(s,d),showDelete:!v,maxThumbnails:3})]}),!v&&e.jsxs("div",{style:{padding:"var(--spacing-md) var(--spacing-lg)",backgroundColor:"var(--color-bg-secondary)",borderTop:"1px solid var(--color-border)",display:"flex",justifyContent:"flex-end",gap:"var(--spacing-sm)"},children:[e.jsx(S,{variant:"outline",size:"small",onClick:()=>O(s),children:"âœï¸ Edit"}),e.jsx(S,{variant:"outline",size:"small",onClick:()=>_(s),style:{borderColor:"var(--color-danger)",color:"var(--color-danger)"},children:"ğŸ—‘ï¸ Delete"})]})]},s.id))})}),e.jsx(be,{isOpen:b,onClose:q,projectId:r,phaseId:n,editLog:I,onLogSaved:T})]})};export{Se as default};
